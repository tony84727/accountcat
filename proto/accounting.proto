syntax = "proto3";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

package accountcat.accounting;

enum AmountType {
  EXPENSE = 0;
  INCOME = 1;
}

message Amount {
  string currency = 1;
  string amount = 2;
}

message NewItem {
  string name = 1;
  Amount amount = 2;
  AmountType type = 3;
  repeated string tags = 4;
}

message Item {
  string id = 1;
  string name = 2;
  Amount amount = 3;
  AmountType type = 4;
  google.protobuf.Timestamp created_at = 5;
  google.protobuf.Timestamp occurred_at = 6;
}

message ItemList {
  repeated Item items = 1;
}

message TagSearch {
  string keyword = 1;
}

message Tag {
  string id = 1;
  string name = 2;
}

message TagList {
  repeated Tag tags = 1;
}

message NewTag {
  string name = 1;
}

message CurrencyList {
  repeated string code = 1;
}

message DeleteItem {
  string id = 1;
}

message UpdateItemRequest {
  string id = 1;
  optional string name = 2;
  Amount amount = 3;
  google.protobuf.Timestamp occurred_at = 4;
}

message DailySpending {
  string income = 1;
  string expense = 2;
  int64 count = 3;
  string date = 4;
  // transaction of non-default currency. Currently, we doesn't support conversion between currencies
  int64 unsupported_count = 5;
}

message DaySpending {
  string date = 1;
  double income = 2;
  double expense = 3;
}

message Last7DayHistogram {
  repeated DaySpending data = 1;
}

service Accounting {
  rpc List(google.protobuf.Empty) returns (ItemList) {}
  rpc Add(NewItem) returns (Item) {}
  rpc CompleteTag(TagSearch) returns (TagList) {}
  rpc CreateTag(NewTag) returns (Tag) {}
  rpc ListCurrency(google.protobuf.Empty) returns (CurrencyList) {}
  rpc Delete(DeleteItem) returns (google.protobuf.Empty) {}
  rpc UpdateItem(UpdateItemRequest) returns (google.protobuf.Empty) {}
  rpc GetDailySpending(google.protobuf.Empty) returns (DailySpending) {} 
  rpc GetLast7DayHistogram(google.protobuf.Empty) returns (Last7DayHistogram) {}
}
